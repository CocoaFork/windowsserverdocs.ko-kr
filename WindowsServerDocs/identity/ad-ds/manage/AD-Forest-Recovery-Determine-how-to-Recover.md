---
title: AD 포리스트 복구-포리스트를 복구 하는 방법 결정
description: ''
ms.author: joflore
author: MicrosoftGuyJFlo
manager: mtillman
ms.date: 08/09/2018
ms.topic: article
ms.prod: windows-server-threshold
ms.assetid: 5a291f65-794e-4fc3-996e-094c5845a383
ms.technology: identity-adds
ms.openlocfilehash: 30d23d977b4d7cd320d78ff340120df7013dee4c
ms.sourcegitcommit: 0d0b32c8986ba7db9536e0b8648d4ddf9b03e452
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 04/17/2019
ms.locfileid: "59817734"
---
# <a name="determine-how-to-recover-the-forest"></a>포리스트를 복구 하는 방법 결정

>적용 대상: Windows Server 2016, Windows Server 2012 및 2012 R2, Windows Server 2008 및 2008 R2

전체 Active Directory 포리스트 복구는 백업에서 복원 또는 Active Directory Domain Services (AD DS)를 다시 설치 하면 포리스트의 모든 도메인 컨트롤러 (DC)에 포함 됩니다. 포리스트 복구 포리스트의 각 도메인 상태가 신뢰할 수 있는 마지막 백업 시점에 복원 합니다. 따라서 복원 작업 하면 손실 적어도 다음 Active Directory 데이터:

- 신뢰할 수 있는 마지막 백업 이후 추가 된 모든 개체 (예: 사용자 및 컴퓨터)
- 모든 업데이트 이후 수행 된 기존 개체에 마지막으로 신뢰할 수 있는 백업
- 구성 파티션에 하거나 (예: 스키마 변경) AD DS에서 스키마 파티션에 신뢰할 수 있는 마지막 백업 이후에 수행 된 모든 변경 내용

포리스트의 각 도메인에 대 한 도메인 관리자 계정의 암호를 알 수 있어야 합니다. 오히려이 기본 제공 관리자 계정의 암호입니다. 또한 DC의 시스템 상태 복원을 수행 하 고 DSRM 암호를 알고 있어야 합니다. 백업이 유효으로 즉, 삭제 된 개체 수명 또는 삭제 표시 수명 기간 내에서 활성인 경우 기간 Directory 휴지통에 대 한 관리자 계정 및 DSRM 암호 기록을 안전한 장소에 보관 하는 것이 좋습니다는 것이 일반적으로 Bin 설정 됩니다. 쉽게 기억할 수 있도록 하려면 도메인 사용자 계정을 사용 하 여 DSRM 암호를 동기화 수 있습니다. 자세한 내용은 기술 자료 문서를 참조 하십시오 [961320](https://support.microsoft.com/kb/961320)합니다. DSRM 계정의 동기화 준비의 일환으로 포리스트 복구 전에 수행 되어야 합니다.

> [!NOTE]
> 관리자 계정은 기본적으로 기본 제공 Administrators 그룹의 구성원으로 Domain Admins 및 Enterprise Admins 그룹입니다. 이 그룹에 도메인의 모든 Dc의 모든 권한이 합니다.

## <a name="determining-which-backups-to-use"></a>사용 하는 백업 확인

각 도메인에 대 한 두 개 이상의 쓰기 가능한 Dc를 정기적으로 백업 하려는 몇 가지 백업 해야 합니다. 쓰기 가능한 DC로 복원 하는 읽기 전용 도메인 컨트롤러 (RODC)의 백업을 사용할 수 없다는 note 합니다. 오류가 발생 하기 전에 몇 일 동안 수행 된 백업을 사용 하 여 Dc를 복원 하는 것이 좋습니다. 일반적으로 recentness 및 복원된 된 데이터의 safeness 절충을 결정 합니다. 최신 백업 보다 유용한 데이터를 복구 하지만 위험한 데이터를 복원 된 포리스트에 재 도입 될 위험이 길어질 수 있습니다를 선택 합니다.

시스템 상태 백업을 복원 하는 작업은 원래 운영 체제 및 서버 백업에 따라 다릅니다. 예를 들어, 시스템 상태 백업을 다른 서버로 복원 하지 해야 합니다. 이 경우 다음과 같은 경고가 나타날 수 있습니다.

"현재 아닌 다른 서버는 지정된 된 백업입니다. 서버를 사용할 수 없게 될 수 있으므로 다른 서버에 백업 사용 하 여 시스템 상태 복구를 수행 하는 것은 좋지 않습니다. ?이 backup을 사용 하 여 현재 서버를 복구 하 시겠습니까? "

다른 하드웨어로 Active Directory를 복원 해야 할 경우 전체 서버 백업 및 전체 서버 복구를 수행 하는 계획을 만듭니다.

> [!IMPORTANT]
> Windows Server 2008 부터는 없습니다 새로운 하드웨어 또는 같은 하드웨어에서 Windows Server의 새 설치로 시스템 상태 백업을 복원 합니다. 이 가이드의 뒷부분에서 권장 사항에 따라 동일한 하드웨어에서 Windows Server를 다시 설치 하는 경우이 순서 대로 도메인 컨트롤러를 복원할 수 있습니다.
>
> 1. 운영 체제 및 모든 파일과 응용 프로그램을 복원 하려면 전체 서버 복원을 수행 합니다.
> 2. Wbadmin.exe를 사용 하 여 SYSVOL을 신뢰할 수 있는 것으로 표시 하기 위해 시스템 상태 복원을 수행 합니다.
>
> 자세한 내용은 Microsoft 기술 자료 참조 문서 [249694](https://support.microsoft.com/kb/249694)합니다.

오류 발생 시점을 알 수 없는 경우 추가로 조사 포리스트의 마지막 수신 상태를 저장 하는 백업을 식별 합니다. 이 방법은 그다지 적합 합니다. 따라서 오류의 대략적인 시간을 식별할 수 포리스트 오류가 있으면 있도록 AD DS의 상태에 대 한 자세한 로그를 매일 유지 하는 것이 좋습니다. 또한 빠르게 복구할 수 있도록 백업의 로컬 복사본을 유지 해야 합니다.

백업 수명은 같은 Active Directory 휴지통을 사용 하는 경우는 **deletedObjectLifetime** 값 또는 **tombstoneLifetime** 값을 작은 값입니다. 자세한 내용은 [Active Directory 휴지통 단계별 가이드](https://go.microsoft.com/fwlink/?LinkId=178657) (https://go.microsoft.com/fwlink/?LinkId=178657)합니다.

대신 사용할 수도 있습니다 (Dsamain.exe) Active Directory 데이터베이스 탑재 도구 있고 확인 Ldp.exe 또는 Active Directory 사용자 및 컴퓨터와 같은 LDAP Lightweight Directory Access Protocol () 도구를 마지막으로 안전 하 게 상태를 포리스트입니다. Windows Server 2008 및 이후 Windows Server 운영 체제에 포함 하는 Active Directory 데이터베이스 탑재 되는 도구를 LDAP 서버로 백업 또는 스냅숏에 저장 된 Active Directory 데이터를 노출 합니다. 그런 다음 데이터를 찾아볼 수는 LDAP 도구를 사용할 수 있습니다. 이 방법은에서 DSRM 디렉터리 서비스 복원 모드 () AD ds 백업 내용을 검사할 모든 DC를 다시 시작 하는 요구 하지 않는 장점이 있습니다.

Active Directory 데이터베이스를 탑재 하는 도구를 사용 하는 방법에 대 한 자세한 내용은 참조는 [Active Directory 데이터베이스 탑재 도구 단계별 가이드](https://technet.microsoft.com/library/cc753609\(WS.10\).aspx)합니다.

사용할 수도 있습니다는 **ntdsutil 스냅숏** Active Directory 데이터베이스의 스냅숏을 만드는 명령입니다. 테이블을 주기적으로 스냅숏을 만드는 작업에 예약 하 여 시간이 지남에 따라 Active Directory 데이터베이스의 추가 복사본을 가져올 수 있습니다. 이러한 복사본 포리스트 실패가 발생을 보다 잘 식별할 선택한 후 최상의 복원할 백업 파일을 사용할 수 있습니다. 스냅숏을 만들려면 버전을 사용 하 여 **ntdsutil** RSAT 원격 서버 관리 도구 () Windows Vista 이상 또는 Windows Server 2008을 사용 하 여 함께 제공 되는 합니다. 대상 DC는 모든 버전의 Windows Server를 실행할 수 있습니다. 사용에 대 한 자세한 내용은 합니다 **ntdsutil 스냅숏** 명령을 참조 하십시오 [스냅숏](https://technet.microsoft.com/library/cc731620\(WS.10\).aspx)합니다.

## <a name="determining-which-domain-controllers-to-restore"></a>복원 하는 도메인 컨트롤러를 결정 합니다.

쉽게 복원 프로세스의 중요 한 요인이 때 복원 하는 도메인 컨트롤러를 결정 합니다. 복원에 대 한 기본 설정 된 DC는 각 도메인에 대 한 전용된 DC가 있기도 하지만 하는 것이 좋습니다. DC를 사용 하면 안정적으로 계획 하 고 수행 하는 데 사용 된 것과 동일한 원본 구성에 사용 하기 때문에 포리스트 복구를 실행 하는 작업을 쉽게 전용된 복원을 테스트를 복원 합니다. 복구 스크립트를 여부나 인지 GC 또는 DNS 서버를 DC 유지 여부 작업 마스터 역할 여부와 같은 다른 구성을 사용 하 여 경쟁 하지.

> [!NOTE]
> 간단히 하기 위해 작업 마스터 역할 소유자를 복원 하는 것은 좋지 않습니다, 일부 조직에서는 다른 장점에 대 한 복원 하도록 선택할 수 있습니다. 예를 들어 RID 마스터 복원 복구 중 Rid를 관리 하는 문제를 방지 하는 데 도움이 됩니다.  

다음 조건을 만족 하는 DC를 선택 합니다.

- 이 쓰기 가능한 DC입니다. 이 필수입니다.

- DC Vm-generationid를 지 원하는 하이퍼바이저에서 가상 머신으로 Windows Server 2012를 실행 합니다. 이 DC 복제에 대 한 원본으로 사용할 수 있습니다.
- DC는 물리적 또는 가상 네트워크에 액세스할 수는 데이터 센터에 있는 것이 좋습니다. 이러한 방식으로 격리할 수 있습니다 쉽게 해당 네트워크에서 포리스트 복구 중.
- 좋은 전체 서버 백업에는 DC입니다. 양호한 백업에는 성공적으로 복원할 수 있습니다 하 고, 실패 하기 전에 며칠 수행한 최대한 훨씬 유용한 데이터가 포함 하는 백업이입니다.
- 실패 하기 전에 도메인 이름 시스템 (DNS) 서버로 사용 했던 DC입니다. 이 DNS를 다시 설치 하는 데 필요한 시간을 저장 합니다.
- Windows 배포 서비스를 사용 하는 경우 BitLocker 네트워크 잠금 해제를 사용 하도록 구성 되지 않은 DC를 선택 합니다. 이 경우 BitLocker 네트워크 잠금 해제에 포리스트 복구 하는 동안 백업에서 복원 하는 첫 번째 DC에 사용 되는 지원 되지 않습니다.

   으로 BitLocker 네트워크 잠금 해제 합니다 *만* 키 보호기 *없습니다* 사용할 Dc에서 배포한 Windows 배포 서비스 (WDS) 이렇게 시나리오 때문에 첫 번째 DC가 필요로 하는 Active Directory 및 WDS의 잠금을 해제 하기 위해 작동 합니다. 하지만 첫 번째 DC를 복원 하기 전에 Active Directory 아니므로 아직 wds를 사용할 수 있는 잠금 해제할 수 없습니다.

   DC BitLocker 네트워크 잠금 해제를 사용 하도록 구성 된 경우를 확인 하려면 다음 레지스트리 키에서 네트워크 잠금 해제 인증서를 식별 되는 확인 합니다.

   HKEY_LOCAL_MACHINESoftwarePoliciesMicrosoftSystemCertificatesFVE_NKP

처리 또는 Active Directory를 포함 하는 백업 파일을 복원 하는 경우 보안 절차를 유지 합니다. 포리스트 복구를 포함 하는 긴급도 보안 모범 사례를 내다보이는 의도 하지 않게 될 수 있습니다. 자세한 내용은의 "설정 도메인 컨트롤러 백업 및 복원 전략" 섹션을 참조 하세요. [Day-to-Day 작업과 Active Directory 설치 보호에 대 한 모범 사례 가이드: 부](https://technet.microsoft.com/library/bb727066.aspx)합니다.

## <a name="identify-the-current-forest-structure-and-dc-functions"></a>현재 포리스트 구조 및 DC 함수를 식별 합니다.

포리스트의 모든 도메인을 식별 하 여 현재 포리스트 구조를 결정 합니다. 백업 된 Dc 및 복제에 대 한 소스 수 있는 가상화 된 Dc 특히 각 도메인의 모든 Dc의 목록을 확인 합니다. 이 도메인을 먼저 복구 됩니다 때문에 가장 중요 한 포리스트 루트 도메인에 대 한 Dc 목록이 됩니다. 포리스트 루트 도메인을 복원한 후 Active Directory 스냅인을 사용 하 여 다른 도메인, Dc 및 포리스트의 사이트 목록을 얻을 수 있습니다.

다음 예제에 표시 된 대로 도메인에 각 DC의 기능을 보여 주는 테이블을 준비 합니다. 복구 후 포리스트의 사전 오류 구성으로 되돌릴 수는 데 도움이 됩니다.

|DC 이름|운영 체제|FSMO|GC|RODC|백업|DNS|Server Core|VM|VM-GenID|  
|-------------|----------------------|----------|--------|----------|------------|---------|-----------------|--------|---------------|  
|DC_1|Windows Server 2012|스키마 마스터 도메인 명명 마스터|예|아니요|사용자 계정 컨트롤|아니오|아니요|예|예|  
|DC_2|Windows Server 2012|없음|예|아니요|예|예|아니요|예|예|  
|DC_3|Windows Server 2012|인프라 마스터|아니오|아니요|아니요|예|예|예|예|  
|DC_4|Windows Server 2012|PDC 에뮬레이터, RID 마스터|예|아니오|아니요|아니요|아니요|사용자 계정 컨트롤|아니오|  
|DC_5|Windows Server 2012|없음|아니요|아니요|예|예|아니요|예|예|  
|RODC_1|Windows Server 2008 R2|없음|예|예|예|예|예|예|아니오|  
|RODC_2|Windows Server 2008|없음|예|예|아니요|예|예|예|아니오|  

포리스트의 각 도메인에 대 한 해당 도메인에 대 한 Active Directory 데이터베이스의 신뢰할 수 있는 백업에 있는 단일 쓰기 가능한 DC를 식별 합니다. DC를 복원할 백업 선택 하면 주의 해야 합니다. 오류의 원인을 확인 하 고 하루 약를 알고 있는 경우 일반적인 권장 사항 경우 해당 날짜 전에 몇 일 동안 수행 된 백업을 사용 합니다.
  
이 예제에서는 백업 후보 4 가지 있습니다. DC_1, DC_2, DC_4, 및 DC_5 합니다. 이러한 백업 후보의 복원만 합니다. 권장 되는 DC에는 다음과 같은 이유로 DC_5는:  

- 가상화 된 DC 복제에 대 한 원본으로 사용 하기 위한 요구 사항 충족, Vm-generationid를 지 원하는 하이퍼바이저에서 가상 DC가 될 수 있는 소프트웨어를 실행 하는 대로 Windows Server 2012 실행 복제 (또는 복제를 사용할 수 없습니다 경우 제거할 수 있습니다 d)입니다. 복원 후 PDC 에뮬레이터 역할 확보 됩니다 하는 도메인에 대 한 복제 가능 도메인 컨트롤러 그룹에 서버 및이 추가할 수 있습니다.  
- Windows Server 2012의 전체 설치를 실행합니다. Server Core 설치를 실행 하는 DC는 복구 대상으로 작은 편리할 수 있습니다.  
- DNS 서버입니다. 따라서 DNS 다시 설치할 필요가 없습니다.  

> [!NOTE]
> DC_5 글로벌 카탈로그 서버가 아니므로 있습니다이 점으로 손꼽을 글로벌 카탈로그를 복원 후 제거할 필요가 없습니다. 하지만 모든 Dc는 글로벌 카탈로그 서버 및 기본적으로를 제거한 후를 포리스트의 일부로 복원 것이 좋습니다에 글로벌 카탈로그를 추가 하 여 DC가 글로벌 카탈로그 서버가 아니므로 결정적인 Windows Server 2012부터으로 있는지 여부 복구 된 경우에 처리 합니다.  

## <a name="recover-the-forest-in-isolation"></a>격리 된 상태에서 포리스트를 복구 합니다.

기본 시나리오는 복원된 된 첫 번째 DC 하기 전에 모든 쓰기 가능한 dc가 종료 되므로 다시 프로덕션입니다. 이렇게 하면 위험한 데이터 복구 포리스트로 다시 복제 되지 않습니다. 특히 모든 작업 마스터 역할 소유자를 종료 하는 것이 반드시 합니다.  

> [!NOTE]
> 시스템 가동 중지 시간을 최소화 하기 위해 온라인 상태로 유지 하려면 다른 Dc를 허용 하는 동안 격리 된 네트워크에 각 도메인에 대 한 복구 하려고 하는 첫 번째 DC를 이동 하는 위치 경우가 있습니다. 예를 들어, 실패 한 스키마 업그레이드에서를 복구 하는 경우 도메인 컨트롤러 격리 된 상태에서 복구 단계를 수행 하는 동안 프로덕션 네트워크에서 실행 되도록 선택할 수 있습니다.

가상화 된 Dc를 실행 하는 경우 이동할 수 있습니다 이러한 프로덕션 네트워크에서 격리 된 가상 네트워크에 복구 수행 하는 위치. 별도 네트워크 가상화 된 Dc 이동 두 가지 이점을 제공 합니다.  

- 복구 된 Dc의 격리 된 이기 때문에 포리스트 복구를 발생 시킨 문제 재발에서 차단 됩니다.  
- 가상화 된 DC 복제 Dc의 중요 한 여러 실행할 수 있도록 별도 네트워크에서 수행 및 테스트할 수 전환 하기 전에 다시 프로덕션 네트워크에 있습니다.

실제 하드웨어에서 Dc를 실행 하는 경우에 포리스트 루트 도메인에서 복원 하려고 하는 첫 번째 DC의 네트워크 케이블을 분리 합니다. 가능 하면 다른 모든 Dc의 네트워크 케이블도 분리 합니다. 이 포리스트 복구 프로세스 중 실수로 시작 되는 경우 복제에서 Dc 방지 합니다.  

여러 위치에 걸쳐 있는 큰 포리스트에서 모든 쓰기 가능한 Dc 종료를 보장 하는 것이 어려울 수 있습니다. 복구 단계를 따라서-메타 데이터 정리에 컴퓨터 계정 및 krbtgt 계정 또한 재설정과 같은-위험한 쓰기 가능한 Dc를 사용 하 여 복구 된 쓰기 가능한 dc가 복제 되지 않습니다을 보장 하기 위한 (일부에서 여전히 온라인 상태인 경우에 포리스트)입니다.  
  
그러나 오프 라인으로 쓰기 가능한 Dc에 의해서만 보장할 수 있습니다 하 복제가 발생 하지 않습니다. 따라서 가능 하면 종료 하 고 포리스트 복구 하는 동안 쓰기 가능한 Dc를 물리적으로 격리 하는 데 도움이 되는 원격 관리 기술을 배포 해야 합니다.  
  
Rodc 계속 쓰기 가능한 Dc 오프 라인 상태인 동안 작동할 수 있습니다. 다른 DC가 없는 모든 RODC에서 변경 내용을 복제 직접 것입니다-특히 스키마 또는 구성 컨테이너 변경 없이-복구 하는 동안 쓰기 가능한 Dc로 동일한 위험이 내포 하지 있도록 합니다. 모든 쓰기 가능한 Dc에는 복구 및 온라인 되 면 모든 Rodc를 다시 작성 해야 합니다.  
  
Rodc는 복구 작업을 병렬로 진행 되는 동안 각 사이트에 캐시 된 로컬 리소스에 액세스할 수 있도록 계속 됩니다. RODC에 캐시 되지 않은 로컬 리소스에 쓰기 가능한 DC로 전달 되는 인증 요청 해야 합니다. 쓰기 가능한 Dc 오프 라인 이므로 이러한 요청이 실패 합니다. 쓰기 가능한 Dc를 복구할 때까지 암호 변경과 같은 일부 작업 하지 작업 수도 있습니다.  
  
허브-스포크 네트워크 아키텍처를 사용 하는 경우 쓰기 가능한 dc가 허브 사이트에서 복구에 먼저 집중할 수 있습니다. 나중에 원격 사이트에서 Rodc를 다시 작성할 수 있습니다.  
  
## <a name="next-steps"></a>다음 단계

- [AD 포리스트 복구-필수 구성 요소](AD-Forest-Recovery-Prerequisties.md)  
- [사용자 지정 포리스트 복구 계획을 고안 AD 포리스트 복구-](AD-Forest-Recovery-Devising-a-Plan.md)  
- [AD 포리스트 복구 문제를 식별 합니다.](AD-Forest-Recovery-Identify-the-Problem.md)
- [AD 포리스트 Recovery-복구 하는 방법 결정](AD-Forest-Recovery-Determine-how-to-Recover.md)
- [AD 포리스트 복구-초기 복구를 수행 합니다.](AD-Forest-Recovery-Perform-initial-recovery.md)  
- [AD 포리스트 복구 절차](AD-Forest-Recovery-Procedures.md)  
- [AD 포리스트 복구-질문과 대답](AD-Forest-Recovery-FAQ.md)  
- [AD 포리스트 복구-Multidomain 포리스트에 단일 도메인 복구](AD-Forest-Recovery-Single-Domain-in-Multidomain-Recovery.md)  
- [AD 포리스트 복구-Windows Server 2003 도메인 컨트롤러를 사용 하 여 포리스트 복구](AD-Forest-Recovery-Windows-Server-2003.md)  
