---
title: 하이퍼 컨 버 지 드 인프라에 대 한 재해 복구 시나리오
ms.prod: windows-server-threshold
ms.manager: eldenc
ms.technology: storage-spaces
ms.topic: article
author: johnmarlin-msft
ms.date: 03/29/2018
description: 이 문서에서는 현재 사용할 수 있는 Microsoft HCI (저장소 공간 다이렉트)의 재해 복구 시나리오를 설명합니다.
ms.localizationpriority: medium
ms.openlocfilehash: 32bbf02ca78d5c6a2147162768c984d0e0b27e36
ms.sourcegitcommit: dfd25348ea3587e09ea8c2224237a3e8078422ae
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 10/16/2018
ms.locfileid: "4678612"
---
# 저장소 공간 다이렉트를 사용 하 여 재해 복구

> 적용 대상: Windows Server 2019, Windows Server 2016

이 항목에서는 재해 복구를 위해 어떻게 하이퍼 컨 버 지 드 인프라 (HCI)에 시나리오를 구성할 수 있습니다.

많은 회사에서 하이퍼 수렴 형 솔루션 실행 중이 고 기능을 유지 해야 하거나로 돌아가기 위해 프로덕션 신속 하 게 재해가 발생 하는 경우 재해가 발생에 대 한 계획 제공 합니다. HCI 재해 복구를 구성 하는 방법은 여러 가지가 및이 문서에서는 현재 사용할 수 있는 옵션을 자세하게 설명 합니다.

때 토론의 가용성을 복원 재해가 발생 하는 경우를 중심으로 복구 시간 목표 (RTO)으로 알려진 합니다. 비즈니스에 허용 되지 않는 결과 방지 하기 위해 서비스를 복원 해야 할 대상 기간입니다. 경우에 따라이 프로세스는 거의 즉시 복원 프로덕션을 사용 하 여 자동으로 발생할 수 있습니다. 다른 경우에서 수동 관리자 개입 서비스를 복원 하 여야 합니다.

하이퍼 수렴 형으로 재해 복구 옵션 현재 다음과 같습니다.

1. 여러 클러스터 저장소 복제본 활용
2. 클러스터 간에 Hyper-v 복제본
3. 백업 및 복원

## 여러 클러스터 저장소 복제본 활용

[저장소 복제본](../storage-replica/storage-replica-overview.md) 볼륨을 복제할 수 있도록 하 고 동기 및 비동기 복제를 지원 합니다. 동기식 또는 비동기식 일 복제를 사용 하 여 사이 선택할 때 복구 지점 목표 (RPO)를 고려해 야 합니다. 복구 지점 목표를 부담 전에 주요 손실 간주 되는 데이터 손실의 양을입니다. 동기 복제를 사용 하 여 이동 하면 동시 양쪽 끝에 쓸 순차적으로 됩니다. 사용 하 여 비동기으로 전환 하는 경우 쓰기는 매우 빠르게 복제 하지만 여전히 손실 될 수 있습니다. 응용 프로그램이 나 파일 사용을 가장 잘 맞는 보려면 고려해 야 합니다.

저장소 복제본은 파일 수준;와 블록 수준 복사 메커니즘입니다. 즉, 중요 하지 않습니다 어떤 유형의 데이터를 복제 합니다. 따라서 하이퍼 컨 버 지 드 인프라에 대 한 인기 있는 옵션이 있습니다. 저장소 복제본도 활용할 수도 다른 유형의 드라이브를 하나의 HCI 형식 저장소의 모든 필요 하므로 복제 파트너 간에 있고 다른에서 다른 형식 저장소 완벽 하 게 괜찮습니다. 

저장소 복제본의 한 가지 중요 한 기능 실행할 뿐 아니라 온-프레미스 및 Azure 수 있다는 점입니다. 온-프레미스 온-프레미스, Azure, Azure 또는 심지어 온-프레미스 azure (또는 그 반대로)을 설정할 수 있습니다.

이 시나리오에서는 두 개의 별도 독립 클러스터 있습니다. [클러스터 간 저장소 복제](../storage-replica/cluster-to-cluster-storage-replication.md)의 단계 따를 HCI 간에 저장소 복제본을 구성할 수 있습니다.

![저장소 복제 다이어그램](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure1.png)

다음 고려 사항이 저장소 복제본을 배포할 때 적용 합니다. 

1.  복제 구성 장애 조치 클러스터링 외부에서 수행 됩니다. 
2.  복제 하는 방법을 선택 네트워크 대기 시간 및 RPO 요구 사항에 따라 좌우 됩니다. 동기 실패 시 데이터 손실 되지 않도록 크래시 일관성을 사용 하 여 대기 시간이 짧은 네트워크에서 데이터를 복제 합니다. 비동기 복제 대기 시간이 더 긴 하지만 각 사이트를 사용 하 여 네트워크를 통해 데이터 동일한 복사본 오류의 동시에 없을 수 있습니다. 
3.  재해의 경우 장애 조치 클러스터 간에 자동 않으며 저장소 복제본 PowerShell cmdlet을 통해 수동으로 오케스트레이션 수 해야 합니다. 위의 다이어그램에서 ClusterA 기본 이며 ClusterB 보조 합니다. ClusterA 다운 되 면 수동으로 리소스 가져올 수 있는 전에 ClusterB 기본으로 설정 해야 합니다. ClusterA 백업 되 면 보조를 확인 해야 합니다. 모든 데이터를 동기화가, 되 면 변경 하 고 원래 설정 된 방식으로 다시 역할 스왑 합니다.
4.  저장소 복제본은 데이터를 복제만 하므로 새 가상 컴퓨터 또는 스케일 아웃 파일 서버 (SOFS)이이 데이터를 활용 하 여 장애 조치 클러스터 관리자 내에서 복제 파트너에 생성 해야 합니다.

가상 컴퓨터 또는 클러스터에서 실행 되는 SOFS 있는 경우 저장소 복제본을 사용할 수 있습니다. HCI 복제본에서 리소스를 온라인 상태로 전환 수동 또는 PowerShell 스크립트를 사용 하 여 자동화 된 수 있습니다.

## Hyper-V 복제본

[Hyper-v 복제본](https://docs.microsoft.com/windows-server/virtualization/hyper-v/manage/set-up-hyper-v-replica) 하이퍼 컨 버 지 드 인프라에 가상 컴퓨터 수준 복제를 재해 복구를 제공합니다. 가상 컴퓨터를 가져오고 보조 사이트 또는 Azure (복제)을 복제 하는 Hyper-v 복제본 수행할 수 있습니다. 그런 다음 보조 사이트에서 Hyper-v 복제본 복제할 수 가상 컴퓨터는 제 3 (확장된 복제).

![Hyper-v 복제 다이어그램](media\storage-spaces-direct-disaster-recovery\Disaster-Recovery-Figure2.png)

Hyper-v 복제본을 사용 하 여 복제는 담당 Hyper-v. 복제에 대 한 가상 컴퓨터를 처음 사용할 때에 해당 복제본 클러스터를 보내도록 복사 초기 하고자 하는 방법에 대 한 세 가지 선택.

1.  네트워크를 통해 초기 복사본을 보내기
2.  서버에 수동으로 복사할 수 있도록 외부 미디어 복사 초기 보내기
3.  이미 복제본 호스트에서 만든 기존 가상 컴퓨터를 사용 합니다.

다른 옵션은이 초기 복제 수행 해야 할 때 합니다.

1.  복제를 즉시 시작
2.  초기 복제를 수행 시기에 대 한 시간을 예약 합니다. 

해야 하는 다른 고려 사항이 있습니다.

- 어떤 VHD/VHDX의 복제 하려는 합니다. 모든 부분이 나 그 중 하나만 복제를 선택할 수 있습니다.
- 저장 하려면 복구 지점의 수입니다. 어떤 복원 하려면 시간에서 지점에 대 한 몇 가지 옵션이 하려는 경우 다음 것 하려는 지정할 수 있습니다. 하나의 복원 지점을 하려는 경우에도 선택할 수 있습니다.
- 볼륨 섀도 복사본 서비스 (vss) 증분 섀도 복사본을 복제 하고자 하는 얼마나 자주 있습니다.
- 얼마나 자주 변경 (5 분, 15 분 30 초) 복제 합니다.

HCI Hyper-v 복제본에 참여 하는 경우 각 클러스터에서 만든 [Hyper-v 복제본 브로커](https://blogs.technet.microsoft.com/virtualization/2012/03/27/why-is-the-hyper-v-replica-broker-required/) 리소스가 있어야 합니다. 이 리소스는 여러 작업을 수행 합니다.

1.  사용 하면 단일 네임 스페이스에 연결 하려면 Hyper-v 복제본에 대 한 각 클러스터에 대 한 합니다.
2.  복제본 (또는 확장된 복제) 상주할 복사본 먼저 수신 되 면 해당 클러스터 내에서 노드를 결정 합니다.
3.  추적의 경우 가상 컴퓨터를 다른 노드로 이동 하는 경우 어떤 노드 복제본 (또는 확장된 복제) 소유 합니다. 적절 한 노드로 정보를 보낼 수 복제를 할 때 되도록이 추적 해야 합니다.

## 백업 및 복원

거의 없는 기술인 이지만 중요 있는 기존 재해 복구 옵션 중 하나는 전체 클러스터 또는 클러스터의 노드에 실패입니다. 이 시나리오를 사용 하 여 두 옵션 중 하나를 사용 하면 Windows NT 백업 사용 합니다. 

항상 하이퍼 컨 버 지 드 인프라의 정기 백업 권장 됩니다. 클러스터 서비스가 실행 되는 동안, 시스템 상태 백업을 사용 하는 경우, 클러스터 레지스트리 데이터베이스에 대 한 해당 백업 기능 중 하나인 것입니다. 두 가지 방법 (비-신뢰할 수 있다고 및 신뢰할 수 있다고)에 클러스터 또는 데이터베이스를 복원 합니다.

### 권한 없는

권한 없는 복원 Windows NT 백업을 사용 하 여 수행할 수 있으며 해당 클러스터 노드 자체의 전체 복원 하는 것과 같습니다. 클러스터 노드 (및 클러스터 레지스트리 데이터베이스)를 복원 해야 하는 경우 및 모든 현재 클러스터 정보 좋은 사용 하 여 신뢰할 수 없는 복원할 수 있습니다. 권한 없는 복원 Windows NT 백업 인터페이스나 명령줄 WBADMIN 통해 수행할 수 있습니다. EXE 합니다.

노드를 복원한 후 클러스터에 가입 하도록 합니다. 하면 발생 하는 기존 실행 중인 클러스터 이동 하 고 현재를 사용 하 여 해당 정보를 모두 업데이트입니다.

### 신뢰할 수 있는

클러스터 구성의 정식 복원을 반면, 시간에 다시 클러스터 구성이 됩니다. 이 유형의 복원 자체 클러스터 정보 손실 되어 복원 해야 하는 경우만 수행 해야 합니다. 예를 들어, 실수로 삭제 된 사용자 1000 공유를 포함 하는 파일 서버 및 다시 필요 합니다. 클러스터의 정식 복원을 완료 하려면 명령줄에서 실행 하는 백업 해야 합니다.

정식 복원을 클러스터 노드에서 시작 되 면 클러스터 보기의 다른 모든 노드에서 클러스터 서비스를 중지 하 고 클러스터 구성을 고정 된 합니다. 이 때문에 클러스터 구성의 새 복사본을 사용 하 여 클러스터 형식이 하므로 복원 된 실행는 노드에서 클러스터 서비스 먼저 시작할 수는 중요 합니다.

정식 복원의 실행 하려면 다음 단계를 수행할 수 있습니다.

1.  WBADMIN를 실행 합니다. 설치 및 시스템 상태는 구성 요소 중 하나 인지 확인 하려는 백업의 최신 버전을 다운로드 하려면 관리자 명령 프롬프트에서 EXE 복원할 수 있습니다.

    ```powershell
    Wbadmin get versions
    ```

2.  에 있는지 확인 해야 하는 버전 백업 클러스터 레지스트리 정보에 구성 요소로 합니다. 이 명령, 버전 및 3 단계에서에서 사용 하기 위해 응용 프로그램/구성 요소에서 해야 하는 몇 가지 항목이 있습니다. 버전에 대 한 예를 들어 백업을 2018 년 1 월 3 일 오전 2 시 04 되었으며 복원 필요한 것입니다.

    ```powershell
    wbadmin get items -backuptarget:\\backupserver\location
    ```

3.  필요한 클러스터 레지스트리 버전을 복구 하는 정식 복원을 시작 합니다. 

    ```powershell
    wbadmin start recovery -version:01/03/2018-02:04 -itemtype:app -items:cluster
    ```

복원이 수행 되 면이 노드 클러스터 서비스를 처음 시작 하 고 클러스터 형성 하 여야 합니다. 다른 모든 노드는 다음 시작 하며 클러스터에 가입 해야 합니다.

## 요약 

이 모든 합계 하이퍼 수렴 형 재해 복구 신중 하 게 로그 아웃 계획 해야 하는 것은 있습니다. 자신의 요구에 가장 적합 한 수 및 철저히 테스트 해야 하는 몇 가지 시나리오가 있습니다. 유의 해야 한 항목에 잘 알고 장애 조치 클러스터를 사용 하 여 이전에 하는 경우 확장 클러스터 되었는지 지난 몇 년 동안 매우 인기 있는 옵션입니다. 약간의 하이퍼 수렴 형 솔루션을 사용 하 여 디자인 변경 했으며 복원 력 기반 합니다. 하이퍼 컨 버 지 드 클러스터에서 두 노드를 분실 전체 클러스터 이동 합니다. 하이퍼 수렴 형 환경에서의 경우가 되 고 확장 시나리오를 지원 하지 않습니다.


