---
title: 원격 데스크톱 가상화 호스트 성능 조정
description: 원격 데스크톱 가상화 호스트에 대 한 성능 조정
ms.prod: windows-server-threshold
ms.technology: performance-tuning-guide
ms.topic: article
ms.author: HammadBu; VladmiS
author: phstee
ms.date: 10/16/2017
ms.openlocfilehash: 24e3243d4e9791c8941729d396e0a96cd8b11a7d
ms.sourcegitcommit: f6490192d686f0a1e0c2ebe471f98e30105c0844
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 09/10/2019
ms.locfileid: "70866435"
---
# <a name="performance-tuning-remote-desktop-virtualization-hosts"></a>원격 데스크톱 가상화 호스트 성능 조정


원격 데스크톱 가상화 호스트 (RD 가상화 호스트)는 VDI (가상 데스크톱 인프라) 시나리오를 지원 하 고 여러 동시 사용자가을 실행 하는 서버에서 호스팅되는 가상 컴퓨터에서 Windows 기반 응용 프로그램을 실행할 수 있도록 하는 역할 서비스입니다. Windows Server 2016 및 Hyper-v.

Windows Server 2016은 두 가지 유형의 가상 데스크톱, 개인용 가상 데스크톱 및 풀링된 가상 데스크톱을 지원 합니다.

**항목 내용**

-   [일반적인 고려 사항](#general-considerations)

-   [성능 최적화](#performance-optimizations)

## <a name="general-considerations"></a>일반적인 고려 사항


### <a name="storage"></a>스토리지

저장소는 가장 가능성이 높은 성능 병목 현상 이므로 저장소 크기를 조정 하 여 가상 머신 상태 변경에 의해 생성 된 i/o 로드를 적절 하 게 처리 해야 합니다. 파일럿 또는 시뮬레이션을 사용할 수 없는 경우 4 개의 활성 가상 머신에 대해 하나의 디스크 스핀 들을 프로 비전 하는 것이 좋습니다. 쓰기 성능이 좋은 디스크 구성 (예: RAID 1 + 0)을 사용 합니다.

디스크 중복 제거 및 캐싱을 사용 하 여 디스크 읽기 부하를 줄이고 저장소 솔루션을 사용 하 여 이미지의 상당 부분을 캐싱하여 성능을 향상 시킬 수 있도록 하는 것이 좋습니다.

### <a name="data-deduplication-and-vdi"></a>데이터 중복 제거 및 VDI

Windows Server 2012 r 2에서 도입 된 데이터 중복 제거는 열려 있는 파일의 최적화를 지원 합니다. 중복 제거 된 볼륨에서 실행 되는 가상 컴퓨터를 사용 하려면 가상 컴퓨터 파일을 Hyper-v 호스트와는 별도의 호스트에 저장 해야 합니다. Hyper-v와 중복 제거를 동일한 컴퓨터에서 실행 하는 경우 두 기능이 시스템 리소스에 대해 경합 하 고 전반적인 성능에 부정적인 영향을 줍니다.

또한 "VDI (가상 데스크톱 인프라)" 중복 제거 최적화 유형을 사용 하도록 볼륨을 구성 해야 합니다. 서버 관리자 (**파일 및 저장소 서비스**  - &gt; **볼륨**  - 중복&gt; **제거 설정**)를 사용 하거나 다음 Windows PowerShell 명령을 사용 하 여이를 구성할 수 있습니다.

``` syntax
Enable-DedupVolume <volume> -UsageType HyperV
```

> [!NOTE]
> 열려 있는 파일의 데이터 중복 제거 최적화는 SMB 3.0를 통한 원격 저장소를 사용 하는 Hyper-v가 포함 된 VDI 시나리오 에서만 지원 됩니다.

### <a name="memory"></a>메모리

서버 메모리 사용량은 세 가지 주요 요소를 기반으로 합니다.

-   운영 체제 오버 헤드

-   가상 컴퓨터당 hyper-v 서비스 오버 헤드

-   각 가상 컴퓨터에 할당 된 메모리

일반적인 지식 근로자 작업의 경우 x86 Window 8 또는 Windows 8.1를 실행 하는 게스트 가상 컴퓨터를 기준으로 512 ~의 메모리를 제공 해야 합니다. 그러나 동적 메모리는 워크 로드에 따라 게스트 가상 컴퓨터의 메모리를 약 800 MB로 늘릴 수 있습니다. X 64의 경우 약 800 MB의 시작, 1024 MB로 확장을 참조 하세요.

따라서 필요한 수의 게스트 가상 컴퓨터에 필요한 메모리를 충족 하기에 충분 한 서버 메모리를 제공 하 고 서버에 충분 한 메모리를 허용 하는 것이 중요 합니다.

### <a name="cpu"></a>CPU

RD 가상화 호스트 서버에 대 한 서버 용량을 계획 하는 경우 실제 코어 당 가상 머신 수는 워크 로드의 특성에 따라 달라 집니다. 처음에는 물리적 코어 당 12 개의 가상 머신을 계획 한 후 적절 한 시나리오를 실행 하 여 성능과 밀도의 유효성을 검사 하는 것이 합리적입니다. 작업의 세부 사항에 따라 더 높은 밀도를 달성할 수 있습니다.

하이퍼 스레딩을 사용 하도록 설정 하는 것이 좋지만 논리적 프로세서 수가 아니라 실제 코어 수를 기준으로 하 여 초과 구독 비율을 계산 해야 합니다. 이렇게 하면 CPU 별로 예상 수준의 성능이 보장 됩니다.

### <a name="virtual-gpu"></a>가상 GPU

RD 가상화 호스트에 대 한 Microsoft RemoteFX는 호스트 쪽 원격, 렌더링 캡처-인코드 파이프라인, 매우 효율적인 GPU 기반 인코드, 클라이언트 기반 조정 등을 통해 VDI (가상 데스크톱 인프라)에 대 한 풍부한 그래픽 환경을 제공 합니다. 작업 및 DirectX 사용 가상 GPU를 사용 합니다. RD 가상화 호스트용 RemoteFX 가상 GPU를 DirectX9에서 DirectX11로 업그레이드 합니다. 또한 고해상도에서 더 많은 모니터를 지원 하 여 사용자 환경을 개선 합니다.

RemoteFX DirectX11 환경은 하드웨어 GPU 없이 소프트웨어 에뮬레이션 드라이버를 통해 사용할 수 있습니다. 이 소프트웨어 GPU는 바람직한 환경을 제공 하지만, RemoteFX VGPU (가상 그래픽 처리 장치)는 가상 데스크톱에 하드웨어 가속 환경을 추가 합니다.

Windows Server 2016를 실행 하는 서버에서 RemoteFX VGPU 환경을 활용 하려면 호스트 서버에 GPU 드라이버 (예: DirectX 11.1 또는 WDDM 1.2)가 필요 합니다. RD 가상화 호스트용 RemoteFX와 함께 사용할 GPU 제공에 대 한 자세한 내용은 GPU 공급자에 게 문의 하세요.

VDI 배포에서 RemoteFX 가상 GPU를 사용 하는 경우 배포 용량은 사용 시나리오 및 하드웨어 구성에 따라 달라 집니다. 배포를 계획할 때 다음 사항을 고려 하십시오.

-   시스템의 Gpu 수

-   Gpu의 비디오 메모리 용량

-   시스템의 프로세서 및 하드웨어 리소스

### <a name="remotefx-server-system-memory"></a>RemoteFX 서버 시스템 메모리

가상 GPU를 사용 하도록 설정 된 모든 가상 데스크톱에 대해 RemoteFX는 게스트 운영 체제 및 RemoteFX 사용 서버에서 시스템 메모리를 사용 합니다. 하이퍼바이저는 게스트 운영 체제에 대 한 시스템 메모리의 가용성을 보장 합니다. 서버에서 각 가상 GPU 사용 가상 데스크톱은 시스템 메모리 요구 사항을 하이퍼바이저에 보급 해야 합니다. 가상 GPU를 사용 하는 가상 데스크톱이 시작 되 면 하이퍼바이저는 VGPU 지원 가상 데스크톱에 대해 RemoteFX 사용 서버에 추가 시스템 메모리를 예약 합니다.

Remotefx 사용 서버에서 사용 되는 메모리 양이 VGPU 지원 가상 데스크톱에 연결 된 모니터 수와에 대 한 최대 해상도에 따라 다르므로 RemoteFX 사용 서버에 대 한 메모리 요구 사항이 동적입니다. 이러한 모니터

### <a name="remotefx-server-gpu-video-memory"></a>RemoteFX 서버 GPU 비디오 메모리

모든 가상 GPU 사용 가상 데스크톱은 호스트 서버의 GPU 하드웨어에 있는 비디오 메모리를 사용 하 여 데스크톱을 렌더링 합니다. 렌더링 외에도 코덱에 비디오 메모리를 사용 하 여 렌더링 된 화면을 압축 합니다. 필요한 메모리 양은 가상 컴퓨터에 프로 비전 되는 모니터의 양에 따라 직접 결정 됩니다.

예약 된 비디오 메모리는 모니터 수와 시스템 화면 해상도에 따라 달라 집니다. 일부 사용자는 특정 작업에 대해 더 높은 화면 해상도를 요구할 수 있습니다. 다른 모든 설정은 일정 하 게 유지 되는 경우 더 낮은 해상도 설정을 사용 하는 확장성이 높아집니다.

### <a name="remotefx-processor"></a>RemoteFX 프로세서

하이퍼바이저는 RemoteFX 사용 서버와 CPU에서 가상 GPU 사용 가상 데스크톱을 예약 합니다. 시스템 메모리와 달리 RemoteFX가 하이퍼바이저와 공유 해야 하는 추가 리소스와 관련 된 정보는 없습니다. RemoteFX가 가상 GPU를 사용 하는 가상 데스크톱에 제공 하는 추가 CPU 오버 헤드는 가상 GPU 드라이버 및 사용자 모드 원격 데스크톱 프로토콜 스택 실행과 관련이 있습니다.

RemoteFX 사용 서버에서 시스템은 가상 GPU 사용 가상 데스크톱 마다 추가 프로세스 (rdvgm)를 실행 하기 때문에 오버 헤드가 증가 합니다. 이 프로세스는 그래픽 장치 드라이버를 사용 하 여 GPU에서 명령을 실행 합니다. 또한 코덱은 클라이언트로 다시 전송 해야 하는 화면 데이터를 압축 하는 데 Cpu를 사용 합니다.

가상 프로세서를 많이 사용 하면 더 나은 사용자 환경을 의미 합니다. 가상 GPU를 사용 하는 가상 데스크톱 당 두 개 이상의 가상 Cpu를 할당 하는 것이 좋습니다. X64 가상 컴퓨터의 성능은 x86 가상 컴퓨터와 비교 하는 것이 더 효율적 이므로 가상 GPU 사용 가상 데스크톱에 x64 아키텍처를 사용 하는 것이 좋습니다.

### <a name="remotefx-gpu-processing-power"></a>RemoteFX GPU 처리 능력

모든 가상 GPU 사용 가상 데스크톱에 대해 RemoteFX 사용 서버에서 해당 하는 DirectX 프로세스가 실행 되 고 있습니다. 이 프로세스는 RemoteFX 가상 데스크톱에서 수신 하는 모든 그래픽 명령을 실제 GPU로 재생 합니다. 실제 GPU의 경우 여러 DirectX 응용 프로그램을 동시에 실행 하는 것과 같습니다.

일반적으로 그래픽 장치 및 드라이버는 데스크톱에서 몇 가지 응용 프로그램을 실행 하도록 조정 됩니다. RemoteFX는 고유한 방식으로 사용할 수 있도록 Gpu를 확장 합니다. RemoteFX 서버에서 GPU를 수행 하는 방법을 측정 하기 위해 RemoteFX 요청에 대 한 GPU 응답을 측정 하기 위해 성능 카운터가 추가 되었습니다.

일반적으로 GPU 리소스가 부족 한 경우 GPU에 대 한 읽기 및 쓰기 작업을 완료 하는 데 시간이 오래 걸립니다. 관리자는 성능 카운터를 사용 하 여 예방 조치를 취하여 최종 사용자의 가동 중지 시간을 없앨 수 있습니다.

가상 GPU 성능을 측정 하기 위해 RemoteFX 서버에서 사용할 수 있는 성능 카운터는 다음과 같습니다.

**RemoteFX 그래픽**

-   **건너뛴 프레임/초-클라이언트 리소스 부족** 클라이언트 리소스가 부족 하 여 건너뛴 초당 프레임 수

-   **그래픽 압축 비율** 입력 바이트 수로 인코딩된 바이트 수의 비율입니다.

**RemoteFX 루트 GPU 관리**

-   **인사 서버 gpu** 의 tdrs TDR 서버에서 GPU의 시간이 초과 되는 총 횟수입니다.

-   **인사 Remotefx** 를 실행 하는 virtual machines remotefx 3d 비디오 어댑터가 설치 된 가상 컴퓨터의 총 수

-   **VRAM 사용 중이 아닌** 전용 비디오 메모리의 GPU 크기 당 사용 가능한 MB

-   **VRAM RemoteFX 용으로 예약** 된 전용 비디오 메모리의 GPU 당 예약 된 비율 (%)

**RemoteFX 소프트웨어**

-   **모니터의 캡처 율** \[1-4\] 모니터 1-4의 RemoteFX 캡처 요금을 표시 합니다.

-   **압축 비율** Windows 8에서 사용 되지 않으며 **그래픽 압축 비율로** 바뀜

-   **지연 된 프레임/초** 특정 기간 내에 그래픽 데이터가 전송 되지 않은 초당 프레임 수

-   **캡처의 GPU 응답 시간** GPU 작업이 완료 될 때까지 RemoteFX 캡처 내에서 측정 되는 대기 시간 (마이크로초)

-   **렌더링의 GPU 응답 시간** GPU 작업이 완료 될 때까지 RemoteFX 렌더링 (마이크로초) 내에서 측정 되는 대기 시간

-   **출력 바이트** RemoteFX 출력 바이트의 총 수

-   **클라이언트 수/초 대기 중** Windows 8에서 사용 되지 않으며 **생략/초 프레임으로 교체 됨-클라이언트 리소스 부족**

**RemoteFX vGPU 관리**

-   **인사 가상 컴퓨터** 에 대 한 tdrs 로컬 가상 컴퓨터에서 발생 한 총 tdrs 수 (tdrs는 가상 컴퓨터로 전파 된 서버는 포함 되지 않음)

-   **인사 서버** 에서 전파 된 tdrs 서버에서 발생 하 여 가상 머신에 전파 된 총 tdrs 수

**RemoteFX 가상 컴퓨터 vGPU 성능**

-   **데이터로 초당 가상 컴퓨터의** 데스크톱으로 렌더링 되는 현재 작업의 총 수/초 (초)입니다.

-   **데이터로 초당 보내는 초당 총 작업 수입니다. 가상 머신에서 서버 GPU로 초당 전송 된 총 작업 수**

-   **데이터로 초당 읽기 바이트/** 초 RemoteFX 사용 서버에서 읽은 총 바이트 수입니다.

-   **데이터로 송신 바이트/초** RemoteFX 사용 서버 GPU로 보낸 초당 총 바이트 수입니다.

-   **DMA 통신 버퍼 평균 대기 시간 (초** ) 통신 버퍼에 소요 된 평균 시간 (초)

-   **DMA Dma가 완료 될 때까지** 전송 된 dma 버퍼 대기 시간 (초)

-   **DMA RemoteFX 3d** 비디오 어댑터의 큐 길이 DMA 큐 길이

-   **인사 가상 컴퓨터에서 gpu** 당 발생 한 TDR 시간 제한 당 TDR 시간 제한 수

-   **인사 Gpu 엔진** 당 TDR 시간 제한-가상 머신에서 gpu 엔진 당 발생 한 TDR 시간 제한 수

RemoteFX 가상 GPU 성능 카운터 외에도 비디오 메모리 사용량 및 GPU 사용률을 보여 주는 프로세스 탐색기를 사용 하 여 GPU 사용률을 측정할 수 있습니다.

## <a name="performance-optimizations"></a>성능 최적화

### <a name="dynamic-memory"></a>동적 메모리

동적 메모리를 사용 하면 실행 중인 가상 컴퓨터 간에 메모리를 분산 하는 방법을 분산 하 여 Hyper-v를 실행 하는 서버의 메모리 리소스를 보다 효율적으로 활용할 수 있습니다. 변경 작업에 대 한 응답으로 가상 컴퓨터 간에 메모리를 동적으로 다시 할당할 수 있습니다.

동적 메모리를 사용 하면 성능 또는 확장성을 저하 시 키 지 않고 이미 보유 한 리소스를 사용 하 여 가상 컴퓨터 밀도를 늘릴 수 있습니다. 결과적으로 비용이 많이 드는 서버 하드웨어 리소스를 보다 효율적으로 사용 하 여 더 쉽게 관리 하 고 비용을 절감할 수 있습니다.

여러 논리 프로세서를 포함 하는 가상 프로세서와 함께 Windows 8 이상을 실행 하는 게스트 운영 체제에서는 메모리 사용을 최소화 하 고 동적 메모리를 해제 하 여 성능을 향상 시킬 수 있도록 동적 메모리와의 실행 간 균형을 고려 합니다. 컴퓨터 토폴로지에서 인식 되는 응용 프로그램입니다. 이러한 응용 프로그램은 토폴로지 정보를 활용 하 여 일정 예약 및 메모리 할당 결정을 내릴 수 있습니다.

### <a name="tiered-storage"></a>계층화된 저장소

RD 가상화 호스트는 가상 데스크톱 풀에 대해 계층화 된 저장소를 지원 합니다. 컬렉션 내의 풀링된 모든 가상 데스크톱에서 공유 하는 물리적 컴퓨터는 미러된 SSD (반도체 드라이브)와 같은 소형 고성능 저장소 솔루션을 사용할 수 있습니다. 풀링된 가상 데스크톱은 RAID 1 + 0과 같은 저렴 한 기존 저장소에 배치할 수 있습니다.

물리적 컴퓨터는 풀링된 가상 데스크톱의 읽기-i/o 대부분이 관리 운영 체제로 이동 하기 때문에 SSD에 배치 해야 합니다. 따라서 물리적 컴퓨터에서 사용 하는 저장소는 초당 훨씬 더 많은 읽기 i/o를 유지 해야 합니다.

이 배포 구성은 성능이 필요한 경우 비용 효율적인 성능을 보장 합니다. SSD는 더 작은 크기의 디스크에서 더 높은 성능을 제공 합니다 (구성에 따라 컬렉션 당 20 GB 당). 풀링된 가상 데스크톱에 대 한 기존 저장소 (RAID 1 + 0)는 가상 머신 당 약 3gb를 사용 합니다.

### <a name="csv-cache"></a>CSV 캐시

Windows Server 2012 이상에서 장애 조치 (Failover) 클러스터링은 CSV (클러스터 공유 볼륨)에 대 한 캐싱을 제공 합니다. 이는 대부분의 읽기 i/o가 관리 운영 체제에서 제공 되는 풀링된 가상 데스크톱 컬렉션에 매우 유용 합니다. CSV 캐시는 두 번 이상 읽은 블록을 캐시 하 고 시스템 메모리에서 배달 하므로 i/o를 줄일 수 있기 때문에 몇 가지 크기의 성능을 제공 합니다. CSV 캐시에 대 한 자세한 내용은 [Csv 캐시를 사용 하도록 설정 하는 방법](http://blogs.msdn.com/b/clustering/archive/2012/03/22/10286676.aspx)을 참조 하세요.

### <a name="pooled-virtual-desktops"></a>풀링된 가상 데스크톱

기본적으로 풀링된 가상 데스크톱은 사용자가 로그 아웃 한 후에 초기 상태로 롤백되고 마지막 사용자 로그인 이후에 Windows 운영 체제에서 변경한 내용이 모두 중단 됩니다.

롤백을 사용 하지 않도록 설정할 수 있지만, 일반적으로 가상 데스크톱 템플릿에 대 한 다양 한 업데이트로 인해 풀링된 가상 데스크톱 컬렉션이 다시 만들어지기 때문에 일시적인 상태입니다.

영구적 상태에 종속 된 Windows 기능 및 서비스를 해제 하는 것이 좋습니다. 또한 주로 엔터프라이즈가 아닌 시나리오에 사용 되는 서비스를 해제 하는 것이 좋습니다.

광범위 한 배포 전에 각 특정 서비스를 적절 하 게 평가 해야 합니다. 다음은 몇 가지 초기 고려해 야 할 사항입니다.

| 서비스                                      | 이유가 무엇일까요?                                                                                                                                                                                                      |
|----------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 자동 업데이트                                  | 풀링된 가상 데스크톱은 가상 데스크톱 템플릿을 다시 만들어 업데이트 됩니다.                                                                                                                          |
| 오프 라인 파일                                | 가상 데스크톱은 항상 온라인 상태 이며 네트워킹 관점에서 연결 됩니다.                                                                                                                         |
| 백그라운드 조각 모음                            | 사용자가 로그 오프 한 후 파일 시스템 변경 내용이 삭제 됩니다 (초기 상태로 롤백 또는 가상 데스크톱 템플릿 다시 만들기로 인해 풀링된 모든 가상 데스크톱이 다시 생성 됨). |
| 최대 절전 모드 또는 절전 모드                           | VDI에 대 한 이러한 개념 없음                                                                                                                                                                                   |
| 버그 확인 메모리 덤프                        | 풀링된 가상 데스크톱에 대 한 이러한 개념은 없습니다. 버그 확인 풀링된 가상 데스크톱이 초기 상태에서 시작 됩니다.                                                                                       |
| WLAN 자동 구성                              | VDI 용 WiFi 장치 인터페이스가 없습니다.                                                                                                                                                                 |
| Windows Media Player 네트워크 공유 서비스 | 소비자 중심 서비스                                                                                                                                                                                  |
| 홈 그룹 공급자                          | 소비자 중심 서비스                                                                                                                                                                                  |
| 인터넷 연결 공유                  | 소비자 중심 서비스                                                                                                                                                                                  |
| Media Center 확장 서비스               | 소비자 중심 서비스                                                                                                                                                                                  |
> [!NOTE]
> 모든 변경 내용이 의도 된 목표 및 시나리오에 영향을 주므로이 목록은 전체 목록이 아닙니다. 자세한 내용은 [PFE!를 제공 하는 즉시 누름, 지금 가져오기, Windows 8 VDI 최적화 스크립트](http://blogs.technet.com/b/jeff_stokes/archive/2013/04/09/hot-off-the-presses-get-it-now-the-windows-8-vdi-optimization-script-courtesy-of-pfe.aspx)를 참조 하세요.

 
> [!NOTE]
> Windows 8의 SuperFetch는 기본적으로 사용 하도록 설정 되어 있습니다. VDI에서 인식 하므로 사용 하지 않도록 설정 하면 안 됩니다. SuperFetch는 VDI에 유용한 메모리 페이지 공유를 통해 메모리 사용을 더 줄일 수 있습니다. Windows 7을 실행 하는 풀링된 가상 데스크톱은 SuperFetch를 사용 하지 않도록 설정 해야 합니다. 그러나 Windows 7을 실행 하는 개인용 가상 데스크톱의 경우에는 그대로 두어야 합니다.

 
