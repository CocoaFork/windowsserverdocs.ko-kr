---
title: Windows Server 2016에에서 hyper V 네트워크 가상화 기술적인 정보
description: 이 항목에서는 Windows Server 2016에 Hyper-v 네트워크 가상화에 대 한 기술 정보 제공
manager: brianlic
ms.custom: na
ms.prod: windows-server-threshold
ms.reviewer: na
ms.service: virtual-network
ms.suite: na
ms.technology:
- networking-sdn
ms.tgt_pltfrm: na
ms.topic: article
ms.assetid: 9efe0231-94c1-4de7-be8e-becc2af84e69
ms.author: pashort
author: shortpatti
ms.openlocfilehash: af2b2a0b151601124bb473c465e7d5a97f2b9150
ms.sourcegitcommit: 19d9da87d87c9eefbca7a3443d2b1df486b0b010
ms.translationtype: MT
ms.contentlocale: ko-KR
ms.lasthandoff: 03/28/2018
---
# <a name="hyper-v-network-virtualization-technical-details-in-windows-server-2016"></a>Windows Server 2016에에서 hyper V 네트워크 가상화 기술적인 정보

>적용 대상: Windows Server 2016

서버 가상화 단일 실제 호스트;에서 동시에 실행 여러 server 인스턴스를 통해 아직 server 인스턴스를 서로 격리 됩니다. 각 가상 컴퓨터 경우 컴퓨터에서 실행 되는 유일한 서버 말 이죠 기본적으로 작동 합니다.  
  
경우에 여러 가상 네트워크 (잠재적으로 겹치는 IP 주소)를 동일에서 실행 실제 네트워크 인프라와 각 가상 네트워크 작동 유일한 가상 네트워크에서 공유 네트워크 infrastructure 실행 되는 경우 처럼, 네트워크 가상화 비슷한 기능을 제공 합니다. 그림 1이이 관계를 표시 합니다.  
  
![네트워크 가상화 모양과 서버 virtualization](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VNetF1.gif)  
  
네트워크 가상화 모양과 서버 virtualization 그림 1:  
  
## <a name="hyper-v-network-virtualization-concepts"></a>Hyper-v 네트워크 가상화 개념  
Hyper-v 네트워크 가상화 (HNV), 고객이 나 테 "소유자" IP 서브넷 기업이 나 데이터 센터에 배포 되는 집합으로 정의 됩니다. 회사 또는 여러 개의 부서 또는 네트워크 격리 해야 하는 개인 데이터 센터에 업무 단위 또는 서비스 공급자 하 여 호스팅된 공개 데이터 센터에 거주 기업 고객이 될 수 있습니다. 각 고객은 하나 이상의 가질 수 [가상 네트워크](#VirtualNetworks) 하나 이상의 네트워크 구성 데이터 센터의 한 각 가상 [가상 서브넷](#VirtualSubnets)합니다.  
  
Windows Server 2016에 제공 될 예정인 HNV 구현을 두 가지: HNVv1 및 HNVv2 합니다.  
  
-   **HNVv1**  
  
    HNVv1은 시스템 Center 2012 r 2 가상 컴퓨터 관리자 VMM () Windows Server 2012 r 2와 호환 됩니다. HNVv1에 대 한 구성 WMI 관리 및 의존 (시스템 센터 VMM를 통해 쉽게 처리) Windows PowerShell cmdlet 격리 설정 및 고객 주소 (캐나다)-가상 네트워크-정의 하 실제 주소 (파) 매핑 및 경로를 합니다. Windows Server 2016에 HNVv1 추가 기능이 추가 되었습니다 및 없는 새로운 기능을 계획입니다.  
    
    • 팀을 설정 하 고 HNV V1 플랫폼에서 호환 되지 않습니다.
    
    O 만들 NVGRE 게이트웨이 사용자가 사용 하 여 필요한 중 하나를 사용 하 여 없이 팀 또는 LBFO 팀 합니다. 또는
    
    설정으로 사용 하 여 네트워크 컨트롤러 배포 게이트웨이 o 스위치를 협력 합니다.

  
-   **HNVv2**  
  
    많은 수의 새로운 기능에는 Azure 가상 필터링 플랫폼 (VFP) 전달 Hyper-v 스위치에서 확장을 사용 하 여 구현 하는 HNVv2 포함 됩니다. 새 네트워크 컨트롤러 소프트웨어 정의 네트워킹 (SDN)에 포함 된 Microsoft Azure 스택 HNVv2 완전히 통합 되어 있습니다.  Microsoft를 통해 가상 네트워크 정책이 정의 [네트워크 컨트롤러](../../../sdn/technologies/network-controller/Network-Controller.md) 는 RESTful NorthBound (참고) API를 사용 하 고 호스트 에이전트를 통해 여러 SouthBound 장치 인터페이스 (SBI) OVSDB 등에 연결 합니다. 호스트 에이전트 프로그램 정책 VFP 확장 Hyper-v 스위치 적용 됩니다.  
  
    > [!IMPORTANT]  
    > 이 항목 HNVv2에 집중합니다.  
  
### <a name="VirtualNetworks"></a>가상 네트워크  
  
-   각 가상 네트워크 하나 이상의 가상 서브넷 구성 됩니다. 가상 네트워크 위치 가상 네트워크에서 가상 컴퓨터 수만 서로 통신할 격리 경계를 구성 합니다. 일반적으로이 격리 분리 된 IP 주소 범위 802.1 q와 Vlan를 사용 하 여 적용 된 태그 또는 VLAN id입니다. 하지만 HNV와 격리 NVGRE 또는 VXLAN 캡슐화 고객이 나 테 넌 간에 IP 서브넷 겹치는 가능성 오버레이 네트워크를 사용 하 여 적용 됩니다.  
  
-   각 가상 네트워크 호스트는 고유 경로 도메인 ID (RDID)에 있습니다. 이 RDID 대략 가상 네트워크 네트워크 컨트롤러의 나머지 리소스를 식별 하는 자원 ID 매핑됩니다. 추가 된 리소스 id 식별자 (URI) 네임을 사용 하 여 가상 네트워크 나머지 리소스를 참조  
  
### <a name="VirtualSubnets"></a>가상 서브넷  
  
-   가상 서브넷 구현 가상 같은 서브넷 가상 컴퓨터에 대 한 Layer 3 IP 서브넷 의미 합니다. 가상 서브넷 형성 (VLAN 비슷함) 브로드캐스트 도메인 하며 격리 NVGRE 테 네트워크 ID (TNI) 또는 VXLAN 네트워크 식별자 (vni) 또는 필드를 사용 하 여 적용 됩니다.  
  
-   각 가상 서브넷 단일 가상 네트워크 (RDID)에 속해 및는 고유 가상 서브넷 ID (VSID) TNI 또는 VNI 키를 사용 하 여 암호화 된 패킷 헤더에 할당 되어 있습니다. VSID 데이터 센터 내 고유 해야 하며 4096-2 범위 내에 ^24 2.  
  
가상 네트워크와 라우팅 도메인의 핵심 장점은 클라우드에 자체 네트워크 토폴로지에 (예: IP 서브넷) 쿠폰이 수 있다는 점입니다. 그림 2 Contoso Corp R 및 D Net와 판매 Net 두 별도 네트워크에 있는 예를 나타냅니다. 이러한 네트워크를 사용 하는 다른 회람 도메인 Id 하기 때문에 없는 상호 작용 하는 서로 합니다. 즉, Contoso & D Net 분리 됩니다 Contoso 판매 Net Contoso Corp. Contoso R 소유 하 고 모두 및 D Net 세 가상 서브넷 포함 되어 있지만. 참고 RDID와 VSID는 내 데이터 센터 고유 합니다.  
  
![고객 네트워크와 가상 서브넷](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VNetF6.gif)  
  
그림 2: 고객 네트워크와 가상 서브넷  
  
**2 계층 전달**  
  
왜냐하면, VSID 5001에서 가상 컴퓨터의 패킷이 Hyper-v 스위치를 통해 VSID 5001에도 있는 가상 컴퓨터에 전달 있을 수 있습니다. Hyper-v 스위치 특정 VPort VSID 5001에서 가상 컴퓨터에서 수신 패킷은 전송 됩니다. 수신 규칙 (예: 캡슐화) 및 매핑 (예: 캡슐화 헤더)이이 패킷에 대 한 Hyper-v 스위치도 적용 됩니다. 패킷이 전달 합니다 Hyper-v 전환에 다른 VPort를 하거나 (대상 가상 컴퓨터 같은 호스트에 연결 되어) 하는 경우 다른 호스트 (대상 가상 컴퓨터가 다른 호스트에 있음) 하는 경우 다른 Hyper-v 스위치 합니다.  
  
**3 경로 계층**  
  
마찬가지로, VSID 5001에서 가상 컴퓨터의 패킷이 각 Hyper-v 호스트 VSwitch에 존재 하는 HNV 분산 라우터에서 VSID 5002 또는 VSID 5003 가상 컴퓨터에 전달 있을 수 있습니다. 시에 Hyper-v 패킷의 제공 전환, HNV 들어오는 패킷이 VSID 대상 가상 컴퓨터의 VSID로 업데이트 합니다. 두 VSIDs 동일한 RDID에 있는 경우에 부과 됩니다.  따라서 RDID1 된 가상 네트워크 어댑터 없이 게이트웨이 탐색 RDID2 된 가상 네트워크 어댑터에 패킷을 보낼 수 없습니다.  
  
> [!NOTE]  
> 패킷 흐름 설명 위의 라는 용어 "가상 컴퓨터" 실제로 의미 가상 컴퓨터에서 가상 네트워크 어댑터입니다. 일반적인 경우 가상 컴퓨터 단일 가상 네트워크 어댑터에만 합니다. 이 경우 단어 "가상 컴퓨터" 및 "가상 네트워크 어댑터" 같은 개념 것일 수 있습니다.  
  
각 가상 서브넷 계층 3 IP 서브넷와 유사한 VLAN 2 계층 (l 2) 브로드캐스트 도메인 경계 정의합니다. 가상 컴퓨터 패킷을 브로드캐스트, HNV 유니캐스트 복제 (UR)를 사용 하 여 원래 패킷 복사본을 만들 동일한 VSID에는 어떤 각 VM의 주소가 대상 IP과 MAC 바꿉니다을 합니다.  
  
> [!NOTE]  
> Windows Server 2016 제공할 때 사용 하 여 유니캐스트 복제 브로드캐스트 및 서브넷 멀티 구현 됩니다. 크로스 서브넷 멀티 캐스트 경로 및 IGMP 지원 되지 않습니다.  
  
브로드캐스트 도메인에 뿐는 VSID 격리를 제공 합니다. HNV의 가상 네트워크 어댑터 ACL 규칙 적용 (virtualNetworkInterface 나머지 리소스) 포트에 직접 또는 중 일부는 가상 서브넷 (VSID)는 Hyper-v 스위치 포트에 연결 됩니다.  
  
Hyper-v 스위치 포트 ACL 규칙을 적용 있어야 합니다. 이 ACL 허용 모두 모두 거부 또는 수만 특정 유형의 5 튜플을 (원본 IP, 대상 IP, 소스 포트 대상 포트, 프로토콜)와 일치 하는에 따라 교통 수 있도록 더 정확 하 게 됩니다.  
  
> [!NOTE]  
> Hyper-v 스위치 확장 HNVv2와 새 소프트웨어 정의 네트워킹 (SDN) 스택에서 작동 하지 않습니다. 다른 타사 스위치 확장와 함께에서 사용할 수 있는 Azure 가상 필터링 플랫폼 (VFP) 스위치 확장을 사용 하 여 HNVv2 구현 됩니다.  
  
## <a name="switching-and-routing-in-hyper-v-network-virtualization"></a>전환 하 고 Hyper V 네트워크 가상화 경로  
올바른 2 계층 (l 2) 전환 및 실제 스위치를 그대로 작동 하도록 계층 3 (l 3) 라우팅 의미 HNVv2 구현 또는 라우터가 작동 합니다. 가상 컴퓨터에 연결 된 HNV 가상 네트워크 원격 가상 컴퓨터의 캘리포니아 MAC 주소를 알아보려면 먼저는 동일한 가상 서브넷 (VSID)의 다른 가상 컴퓨터와 연결을 설정 하려고 합니다. 소스 가상 컴퓨터 ARP 표에 대상 가상 컴퓨터의 IP 주소에 대 한 ARP 항목이 있는 경우이 항목의 MAC 주소가 사용 됩니다. 항목이 없는 경우 원본 가상 컴퓨터에 해당 하는 대상 가상 컴퓨터의 IP 주소 MAC 주소에 대 한 요청에 반환할 ARP 방송 보냅니다. Hyper-v 스위치가이 요청을 차단 되며 호스트 에이전트에 게 보냅니다. 호스트 에이전트 요청한 대상 가상 컴퓨터의 IP 주소에 대 한 해당 MAC 주소를에 대 한 현지 데이터베이스에 알아봅니다.  
  
> [!NOTE]  
> OVSDB 서버로 호스트 에이전트 VTEP 스키마 변형을 사용 하 여 캘리포니아 파 매핑, MAC 테이블 및에 저장 합니다.  
  
MAC 주소를 사용할 수 있게 호스트 에이전트 ARP 응답 삽입 하 고 가상 컴퓨터에이 기능을 다시 보냅니다. 가상 컴퓨터의 네트워킹 스택은 필요한 모든 l 2 헤더 정보를 해당 Hyper-v 포트 V 스위치에 프레임 전송 됩니다. 내부적으로 Hyper-v 스위치가이 프레임 V 포트에 할당 N 튜플을 일치 하는 규칙에 대 한 테스트 하 고 프레임 다음이 규칙을 기준으로 특정 변환을 적용 됩니다. 가장 중요 하 게 캡슐화 변환 설정 구성 NVGRE 또는 VXLAN를 사용 하 여 네트워크 컨트롤러에서 정의 정책에 따라 캡슐화 헤더에 적용 됩니다. 호스트 에이전트가 프로그래밍 정책에 따라, 캐나다 파 지도 사용 Hyper-v 호스트 IP 주소를 확인 대상 가상 컴퓨터 있는. 올바른 라우팅 규칙 Hyper-v 스위치를 설치할 수 있도록 보장 및 원격 파 주소 도달할 하므로 VLAN 태그 외부 패킷에 적용 됩니다.  
  
가상 컴퓨터 HNV 가상 네트워크에 연결 된를 서로 다른 가상 서브넷 (VSID)에서 가상 컴퓨터와 연결 하려는 경우 패킷을 적절 하 게 전달 해야 합니다. 가정 별 토폴로지 HNV 다음 홉으로 모든 IP 접두사 (의미 기본 경로/게이트웨이)에 도달 하는 데 사용 캘리포니아 공간에는 하나의 IP 주소 합니다. 현재 하나의 기본 경로에 제한이 적용와 기본 비 경로 지원 되지 않습니다.  
  
### <a name="routing-between-virtual-subnets"></a>가상 서브넷 경로  
실제 네트워크 IP 서브넷은 서로 컴퓨터 (가상 및 물리적) 통신할 직접 수 2 계층 (l 2) 도메인. L 2 도메인 ARP 응답 호스트 요청로 다시 전송 되 고 있는 ARP 항목 (IP:MAC 주소 지도)은 모든 인터페이스에서 방송 하 ARP 요청을 통해 알게 된 브로드캐스트 도메인이입니다. 컴퓨터 완전히 l 2 프레임 이더넷 헤더를 포함 한 구성 ARP 응답 으로부터 배우고 MAC 정보를 사용 합니다. 그러나 다른 l 3 서브넷에 IP 주소가 있으면 ARP 요청 거치지 않기이 l 3 경계 합니다. 대신, 소스 서브넷에 IP 주소를 사용 하 여 l 3 라우터 인터페이스 (다음 홉 또는 기본 게이트웨이) MAC 주소를 사용 하 여 이러한 ARP 요청 응답 해야 합니다.  
  
표준 Windows 네트워킹 관리자 고정 경로 만들 하 고 네트워크 인터페이스를 지정할 수 있습니다. 또한 "기본 게이트웨이"에 대 한 기본 경로 (0.0.0.0 / 0) 패킷을 전송 되는 인터페이스에 다음 홉 IP 주소를 일반적으로 구성 됩니다. 특정 경로가 없는 경우이 기본 게이트웨이 패킷은 전송 됩니다. 라우터 실제 네트워크에 대 한 것 같습니다.  HNV 모든 호스트의 일부인 되었으며 인터페이스 가상 네트워크에 대 한 분산된 라우터를 만들려면 모든 VSID에 기본 제공 라우터가 사용 합니다.  
  
HNV 가정 스타 토폴로지, 이후 HNV 분산된 라우터 같은 VSID 네트워크에 포함 된 가상 서브넷 간의 진행 되 고 모든 교통에 대 한 단일 기본 게이트웨이으로 작동 합니다. 주소 기본 게이트웨이 기본값으로 VSID에 최저 IP 주소를 사용 하 고 HNV 분산 라우터에 지정 됩니다. 이 분산된 라우터 각 호스트 직접 교통량을 경로 적절 한 호스트 중간을 않고도 때문에 적절 하 게 전달 하는 효율적인 방법에 대 한 모든 교통 VSID 네트워크 내 수 있습니다.  두 개의 가상 컴퓨터에서 동일한 VM 네트워크 있지만 서로 다른 가상 서브넷 같은 실제 호스트에 있을 때 특히 마찬가지입니다.  이 섹션의 나중에 표시 됩니다 패킷의을 남깁니다. 실제 호스트 절대은 있습니다.  
  
### <a name="routing-between-pa-subnets"></a>파 서브넷 경로  
할당 한 파 IP 주소에 대 한 각 가상 서브넷 (VSID) HNVv1 달리 HNVv2 이제 Switch-Embedded 팀 (설정) NIC 팀 멤버 마다 하나의 파 IP 주소를 사용 합니다. 기본 배포 2 NIC 팀을 호스트 별로 두 개 파 IP 주소를 지정 합니다. 단일 호스트 동일한 공급자 (파) 논리 서브넷 같은 VLAN에 할당 된 파 IPs에 있습니다. 두 명의 테 Vm에서 가상 같은 서브넷 실제로 두 가지 공급자 논리 서브넷에 연결 하는 두 가지 호스트에 있을 수 있습니다. HNV는 캐나다 파 매핑에 따라 암호화 된 패킷에 대 한 외부 IP 헤더를 생성 됩니다. 그러나 기본 파 게이트웨이의 arp 호스트 TCP/IP 스택에 의존 하 고 ARP 응답에 따라 외부 이더넷 머리글 빌드. 일반적으로이 ARP 응답에서에서 나옵니다 SVI 인터페이스 실제 스위치 또는 l 3 라우터에서 호스트 연결 되어 있습니다. 따라서 l 3 라우터 공급자 논리 서브넷 간에 캡슐화 패킷을 경로를 HNV에 의존 / Vlan 합니다.  
  
### <a name="routing-outside-a-virtual-network"></a>가상 네트워크에서 벗어나 있는 경로  
대부분의 고객 배포 HNV 환경에 포함 되지 않은 리소스에 HNV 환경에서 통신이 필요 합니다. 네트워크 가상화 게이트웨이 두 환경의 통신할 수 있도록 필요 합니다. 필요한 HNV 게이트웨이 인프라 개인 클라우드 및 혼합 클라우드 포함 됩니다. 기본적으로 HNV 게이트웨이 계층 3 경로 내부 및 외부 (물리적) 네트워크 (NAT 포함) 또는 다른 사이트 및/또는 VPN IPSec 또는 GRE 터널을 사용 하는 클라우드 (또는 개인 공개) 간에 필요 합니다.  
  
게이트웨이 다른 물리적 폼 팩터와에서 가져온 것일 수 있습니다. 한 랙 위에 (에) 스위치 역할을 통해 가상 IP (VIP)는 부하 분산 알리는 액세스 VXLAN 게이트웨이 기존 다른 네트워크 기기 모드로 전환 하거나 새 독립 실행형 네트워크 기기 될 수 있습니다에 통합, Windows Server 2016에 빌드할 수 있습니다.  
  
Windows RAS 게이트웨이 옵션에 대 한 자세한 내용은 참조 [RAS 게이트웨이](../../../../remote/remote-access/ras-gateway/RAS-Gateway.md)합니다.  
  
## <a name="packet-encapsulation"></a>패킷 캡슐화  
HNV의 각 가상 네트워크 어댑터는 두 가지 IP 주소와 연결 합니다.  
  
-   **고객 주소** (캐나다)에서 IP 주소가 인트라넷 인프라에 따라 고객별 할당 합니다. 이 주소 공용 또는 개인 클라우드로 이동 하지 해야 하는 경우 네트워크 교통 가상 컴퓨터를 교환 하려면 연락처 고객 수 있게 합니다. 캐나다의 가상 컴퓨터에 표시 되며 고객이 연결할 수 있습니다.  
  
-   **공급자 주소** 호스팅 공급자에서 할당 (파) IP 주소 또는 실제 네트워크 인프라에 따라 datacenter 관리자입니다. 파는 실행 Hyper-v 가상 컴퓨터가 호스트 하는 서버 교환 되는 네트워크에서 패킷을에 표시 됩니다. 표시 되는 파 실제 네트워크에 있지만 가상 컴퓨터 수 없습니다.  
  
Ca 가상화 이며 구현 PAs 하 여 실제 기본 실제 네트워크 토폴로지와 주소에서 분리 하는 고객의 네트워크 토폴로지를 유지 합니다. 다음 그림의 개념 관계 CAs 가상 컴퓨터 및 네트워크 인프라 PAs 네트워크 가상화 결과 보여 줍니다.  
  
![네트워크 가상화 물리적 인프라를 통해의 개념도](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VNetF2.gif)  
  
네트워크 가상화 물리적 인프라를 통해의 개념도 그림 6:  
  
다이어그램을 고객 가상 컴퓨터 자신의 가상 네트워크 또는 "터널"를 통해 실제 네트워크 infrastructure 통과 하는 데이터 패킷이 캘리포니아 공간을 보냅니다. 위 예제에서는 게 전달할 소스 호스트 왼쪽에서 오른쪽 대상 호스트 녹색 발송 레이블 (파 주소)를 연결 하는 Contoso 데이터 패킷이 전 "봉투"로 터널의 생각할 수 있습니다. 키는 호스트 "배송 주소" 결정 하는 방법입니다 (파의), 해당 하는 Contoso 및 Fabrikam 캘리포니아 패킷을 전 "봉투" 두는 어떻게 대상 호스트 수 패킷의 래핑을 방법과 올바르게 대상 가상 컴퓨터에 연결 하는 Contoso를 제공 합니다.  
  
이 간단한 비유 네트워크 가상화의 주요 측면을 강조 표시 합니다.  
  
-   실제 호스트 PA. 매핑됩니다 각 가상 컴퓨터 캘리포니아 여러 개의 Ca 같은 PA.와 관련 된 될 수 있습니다.  
  
-   가상 컴퓨터 데이터 패킷이 "둘러싸기를" 파 원본과 대상 쌍으로 매핑이에 따라에 저장 되는 캘리포니아 공간 전송 합니다.  
  
-   캘리포니아 파 매핑 호스트 다른 고객 가상 컴퓨터에 대 한 패킷을 구분을 허용 해야 합니다.  
  
결과적으로, 가상 컴퓨터에서 사용 하는 네트워크 주소 가상화 하는 네트워크 가상화 하는 장치가입니다. 네트워크 컨트롤러 주소 지도 대해 책임이 및 호스트 에이전트 MS_VTEP 스키마를 사용 하는 지도 데이터베이스를 유지 합니다. 다음 섹션 주소 가상화의 실제 메커니즘을 설명 합니다.  
  
## <a name="network-virtualization-through-address-virtualization"></a>네트워크 가상화 주소 virtualization 통해  
HNV 구현 네트워크 가상화 일반 경로 캡슐화 (NVGRE) 또는 가상 eXtensible 네트워크 (VXLAN)를 사용 하 여 테 네트워크 오버레이됩니다.  VXLAN 기본값입니다.  
  
### <a name="virtual-extensible-local-area-network-vxlan"></a>가상 eXtensible 네트워크 (VXLAN)  
가상 eXtensible 네트워크 (VXLAN) ([RFC 7348](http://www.rfc-editor.org/info/rfc7348)) 프로토콜 Cisco, Brocade, Arista, Dell HP 등과 같은 공급 업체 로부터 지원 지역/국가 위치에 광범위 하 게 채택 했습니다. VXLAN 프로토콜 전송으로 UDP을 사용합니다. VXLAN에 대 한 IANA 할당 UDP 목적지 포트 4789 이며 UDP 소스 포트 콘텐츠의 해시 내부 패킷 확산 ECMP에 사용 되는 정보 여야 합니다. UDP 머리글 후 VXLAN 헤더를 포함 3 바이트 필드에 대 한는 VXLAN 네트워크 식별자 (vni) 또는-VSID-예약 된 다른 1 바이트 필드 이어서 이어서 예약된 4 바이트 필드 패킷에 추가 됩니다. 캘리포니아 이더넷 프레임 FCS) (없이 원래 캘리포니아 l 2 프레임 VXLAN 헤더 후 추가 됩니다.  
  
![VXLAN 패킷 헤더](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VXLAN-packet-header.png)  
  
### <a name="generic-routing-encapsulation-nvgre"></a>일반 라우팅 간략화 (NVGRE)  
이 네트워크 가상화 메커니즘 터널 머리글의 일환으로 일반 경로 캡슐화 (NVGRE)를 사용합니다. NVGRE, 가상 컴퓨터의 패킷 다른 패킷 내 캡슐화 됩니다. 이 새 패킷 헤더에 적절 한 소스 및 대상 파 IP 주소 그림 7와 같이 GRE 헤더 키 분야에 저장 된 가상 서브넷 ID 외에도 있습니다.  
  
![NVGRE 캡슐화](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VNetF3.gif)  
  
그림 7: 네트워크 가상화 NVGRE 캡슐화  
  
가상 서브넷 ID 지정된 된 패킷에 대 한 고객 가상 컴퓨터를 식별할 수 있게, 패킷을에 파의와 캐나다의의 경우에 겹치는 될 수 있습니다. 이렇게 하면 모든 가상 컴퓨터에 단일 파 공유 하는 동일한 호스트 그림 7와 같이.  
  
네트워크 확장성은 파 공유에 큰 영향을 합니다. 네트워크 인프라 배울 해야 하는 MAC 및 IP 주소 수가 충분히 줄일 수 있습니다. 예를 들어 모든 종료 호스트 IP 수가 30 가상 컴퓨터의 평균 있으며 30. 패킷에 포함 된 가상 서브넷 Id 배 하 여 네트워킹 인프라 배울 해야 하는 MAC 주소를 줄입니다 경우 실제 고객에 게 패킷 쉽게 상관 또한 사용 합니다.  
  
Windows Server 2012 r 2에 대 한 구성표 공유 파 호스트 당 VSID 마다 하나의 파입니다. Windows Server 2016 용 구성표 NIC 팀 멤버 별로 한 파입니다.  
  
Windows Server 2016 이상과, HNV 완벽 하 게 지원 NVGRE 및 VXLAN는 개봉 후; 업그레이드 하거나 새로운 네트워크 하드웨어 Nic (네트워크 어댑터), 스위치를 라우터 등을 구입 필요 하지 않습니다. 네트워크에서 이러한 패킷을 오늘 네트워크 인프라와 호환 되는 파 공간 일반 IP 패킷 하기 때문입니다.  그러나 최상의 성능을 사용을 Nic 최신 드라이버를 지 원하는 작업 오프 로드 함께 지원 됩니다.  
  
## <a name="multi-tenant-deployment-example"></a>멀티 테 배포 예제  
다음 그림 네트워크 정책에서 정의 캘리포니아 파 관계 클라우드 데이터 센터에 있는 두 고객의 예 배포를 보여 줍니다.  
  
![멀티 테 배포 예제](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VNetF5.png)  
  
멀티 테 배포 예제 그림 8:  
  
그림 8의 예를 것이 좋습니다. 호스팅 공급자에 게 이동 하기 전에 IaaS 서비스의 공유 합니다.  
  
-   Contoso Corp 실행 SQL Server (라는 **SQL**)에 IP 주소 10.1.1.11 및 웹 서버 (라는 **웹**) 그 SQL Server 데이터베이스 거래를 사용 하 여 IP 주소가 10.1.1.12, 합니다.  
  
-   Fabrikam Corp 라고도 함 SQL Server, 실행 **SQL** 10.1.1.11, IP 주소와 라고도 하는 웹 서버를 할당 **웹** 도 10.1.1.12 IP 주소에서 사용 하 여 해당 SQL Server 용 트랜잭션 데이터베이스 합니다.  
  
호스팅 서비스 공급자는 공급자 (파) 논리 네트워크 실제 네트워크 토폴로지에 해당 하는 네트워크 컨트롤러를 통해 만들었습니다 이전에 가정 합니다. 네트워크 컨트롤러 논리 서브넷 IP 접두사 호스트 연결 되어 있는에서 두 개의 파 IP 주소를 할당 합니다. 네트워크 컨트롤러도 IP 주소를 적용 하려면 해당 VLAN 태그를 나타냅니다.  
  
다음 네트워크 컨트롤러, Contoso Corp 및 Fabrikam Corp 사용 하 여 만들어의 가상 네트워크 서브넷 호스팅 서비스 공급자에 지정 된 논리 네트워크 공급자 (파) 백업입니다. Contoso Corp 및 Fabrikam Corp 자녀가 해당 SQL Server 이동 하 고 같은 호스팅 공급자의 웹 서버 IaaS 서비스 멋지게 이와 동시에 위치를 공유는 **SQL** 호스트 1 Hyper-v의 가상 컴퓨터 및 **웹** Hyper-v 호스트 2 가상 컴퓨터 (i i s 7). 모든 가상 컴퓨터의 원래 인트라넷 IP 주소 (CAs 자신의)를 유지합니다.  
  
아래와 같이 두 회사 네트워크 컨트롤러 하 여 다음과 같은 가상 서브넷 ID (VSID) 지정 됩니다.  각 Hyper-v 호스트 호스트 에이전트 네트워크 컨트롤러에서 할당된 파 IP 주소를 수신 하 고 기본 아닌 네트워크에 두 개의 파 호스트 vNICs 만듭니다. 네트워크 인터페이스 각 아래와 같이 파 IP 주소 할당 이러한 호스트 vNICs에 할당 되어 있습니다.  
  
-   VSID 및 PAs Contoso Corp 가상 컴퓨터: **VSID** 5001는 **SQL 파** 192.168.1.10는 **웹 파** 192.168.2.20는  
  
-   VSID 및 PAs Fabrikam Corp 가상 컴퓨터: **VSID** 6001는 **SQL 파** 192.168.1.10는 **웹 파** 192.168.2.20는  
  
네트워크 컨트롤러 (표에 OVSDB 데이터베이스) 영구 스토어 정책을 유지 하 여 SDN 호스트 에이전트에 (캐나다 파 매핑 포함) 모든 네트워크 정책을 plumbs 합니다.  
  
Hyper-v 호스트 2 Contoso Corp 웹 가상 컴퓨터 (10.1.1.12) SQL server TCP 연결 10.1.1.11에을 만든 다음 상황이 발생 합니다.  
  
-   VM Arp 10.1.1.11의 MAC 주소 대상에 대 한  
  
-   고 vSwitch에 VFP 확장이이 패킷 차단 하 고 SDN 호스트 에이전트에 게 보낼  
  
-   해당 정책 저장소 10.1.1.11의 MAC 주소를 SDN 호스트 에이전트 검색  
  
-   호스트 에이전트 VM에 ARP 응답 삽입 MAC 발견 되 면  
  
-   MAC 없으면 응답이 전송 되 고 연결할 수 없는 10.1.1.11에 대 한 VM에서 ARP 항목으로 표시 됩니다.  
  
-   VM 이제 TCP 패킷을 올바른 캘리포니아 이더넷 및 IP 헤더를 생성 하 고 고 vSwitch를 전송  
  
-   전달 하 고 vSwitch에 확장 VFP 처리 VFP 계층 (아래 설명 참조) 패킷을 받은 및 VFP 통합된 흐름 표에 새 흐름 항목을 만들고 소스 vSwitch 포트에 할당을 통해이 패킷이  
  
-   VFP 엔진 IP 및 이더넷 헤더에 따라 각각 계층 (예: 가상 네트워크 계층)에 대 한 규칙와 일치 하는 또는 흐름 테이블 조회를 수행 합니다.  
  
-   가상 네트워크 계층에서 일치 하는 규칙 캘리포니아 파 매핑 공간을 참조 하 고 캡슐화를 수행 합니다.  
  
-   캡슐화 유형 (VXLAN 또는 NVGRE)는 VSID 함께 VNet 계층 지정 됩니다.  
  
-   VXLAN 캡슐화의 경우 외부 UDP 헤더 VXLAN 헤더에 5001 VSID 구성 되어 있습니다.  
    외부 IP 헤더 Hyper-v 호스트 2 (192.168.2.20)와 Hyper-v 호스트 1 (192.168.1.10) SDN 호스트 에이전트 정책 스토어에 따라 각각에 할당 원본과 대상 파 주소와 생성 됩니다.  
  
-   파 라우팅 계층 VFP에 다음이 패킷 이동합니다.  
  
-   파 라우팅 계층 VFP에 파 공간 교통 및 VLAN ID를 사용 하는 네트워크 삽입 참조 하 고 올바르게 파 패킷 Hyper-v 호스트 1에 전달 하도록 호스트의 TCP/IP 스택 사용 합니다.  
  
-   암호화 된 패킷 수령 Hyper-v 호스트 1는 파 네트워크에에서 패킷의 받아서 고 vSwitch에 게 전달 됩니다.  
  
-   VFP 해당 VFP 계층을 통해 패킷 처리 하 고 VFP 통합된 흐름 테이블에 새 흐름 항목을 만듭니다.  
  
-   VFP 엔진에서 가상 네트워크 계층 ingres 규칙와 일치 하 고 외부 암호화 된 패킷 이더넷, IP, 및 VXLAN 헤더를 제거 합니다.  
  
-   VFP 엔진 패킷을 대상 VM 연결 되어 있는 vSwitch 포트 전달 합니다.  
  
교통 Fabrikam Corp 사이 대 한 유사 프로세스 **웹** 및 **SQL** 가상 컴퓨터의 HNV 정책 설정을 Fabrikam Corp. 사용 결과적으로, Corp HNV, Fabrikam 및 Contoso Corp 가상 컴퓨터와 상호 작용에 원래 인트라넷 듯 합니다. 절대 상호 작용할 수 서로 동일한 IP 주소를 사용 하는 경우에 있습니다.  
  
(CAs 및 PAs) 별도 주소, Hyper-v 호스트 정책 설정을 캐나다의 인바인드 및 아웃 바운드 가상 컴퓨터 교통량 파 사이의 주소 변환이 NVGRE 키나 VLXAN VNID 중 하나를 사용 하 여 서버이 세트를 분리 합니다. 또한 virtualization 매핑 및 변환 가상 네트워크 아키텍처 실제 네트워크 인프라를 분리 합니다. 하지만 Contoso **SQL** 및 **웹** 에 연결 하는 **SQL** 및 **웹** 자체 캘리포니아 IP 서브넷 (10.1.1/24)에 거주, 실제 배포 각각 두 호스트 다른 파 서브넷, 192.168.1/24 및 192.168.2/24에 발생 합니다. 메모리 간 서브넷 가상 컴퓨터 프로비저닝 하 고 실시간 마이그레이션 HNV 가능 될입니다.  
  
## <a name="hyper-v-network-virtualization-architecture"></a>Hyper-v 네트워크 가상화 건축물  
Windows Server 2016 있는 Azure 가상 필터링 플랫폼 (VFP)는 Hyper-v 스위치 내 NDIS 필터링 확장을 사용 하 여 HNVv2 구현 했습니다. 주요 VFP 개념 네트워크 정책 프로그래밍 SDN 호스트 에이전트에 노출 내부 API와 일치 알림 흐름 엔진의 됩니다. 자체 SDN 호스트 에이전트 OVSDB 및 WCF SouthBound 통신 채널을 통해 네트워크 컨트롤러에서 네트워크 정책을 받습니다. 뿐만 아니라 가상 네트워크 정책입니다 (예: 캐나다 파 매핑) VFP 있지만 Acl, QoS, 등과 같은 추가 정책을 사용 하 여 프로그래밍 합니다.  
  
VFP 확장 전달 하 고 vSwitch에 대 한 개체 계층 다음과 같습니다.  
  
-   vSwitch  
  
    -   외부 NIC 관리  
  
    -   NIC 하드웨어 오프 로드  
  
    -   글로벌 전달 규칙  
  
    -   포트  
  
        -   머리카락 고정 계층 전달 송신  
  
        -   NAT 풀 및 매핑 공간 목록  
  
        -   통합된 흐름 표  
  
        -   VFP Layer  
  
            -   흐름 표  
  
            -   그룹  
  
            -   규칙  
  
                -   규칙 공간 참조할 수 있습니다.  
  
VFP에서 계층 정책 유형 (예: 가상 네트워크)에 따라 생성 되 고 규칙/흐름 테이블 일반 집합입니다. 이러한 기능을 구현 하도록 특정 규칙 해당 layer에 할당 될 때까지 내장 된 기능이 필요가 없습니다. 각 계층은 우선 순위가 지정 됩니다 및 우선 순위 부여 오름차순가 layers 포트에 할당 합니다. 규칙은 주로 방향 및 IP 주소 제품군에 따라 그룹으로 구성 되어 있습니다. 그룹 우선 순위를 할당도 및 그룹에서 한 규칙 지정된 흐름와 일치 수 있는 최대 합니다.  
  
VFP 확장명이 vSwitch에 대 한 전달 논리는 다음과 같습니다.  
  
-   수신 처리 (포트 출시 패킷 관점에서 수신)  
  
-   전달  
  
-   송신 처리 (포트 두면 패킷 관점에서 송신)  
  
VFP 가까운 MAC 전달 외부 기반 MAC VLAN 전달 NVGRE 및 VXLAN 캡슐화 형식에 대 한 지원합니다.  
  
VFP 확장 느린 경로 및 패킷 탐색에 대 한 빠른 경로에 있습니다. 흐름의 첫 번째 패킷이 각 layer의 모든 규칙 그룹 통과 하 고 규칙을 수행 해야 하는 작업 조회와 합니다. 그러나 흐름 (일치 규칙에 따름) 동작의 목록으로 통합된 흐름 테이블에 등록 한 후 모든 이후 패킷은 됩니다에 따라 처리 통합된 흐름 테이블 항목 합니다.  
  
호스트 에이전트가 HNV 정책 프로그램 됩니다. 가상 컴퓨터 네트워크 어댑터 각 IPv4 주소도 구성 됩니다. 이러한 이란는 서로 통신할 수 가상 컴퓨터에서 사용할 수 있는 하 고에서 가상 컴퓨터의 IP 패킷을 수행 됩니다. HNV 캡슐화 호스트 에이전트 데이터베이스에 저장 된 네트워크 가상화 정책에 따라 파 프레임에서 캘리포니아 프레임 합니다.  
  
![HNV 건축물](../../../media/hyper-v-network-virtualization-technical-details-in-windows-server/VNetF7.png)  
  
그림 9: HNV 건축물  
  
## <a name="summary"></a>요약  
클라우드 기반 센터 향상 된 확장성 조정은 등 많은 혜택을 제공할 수 있습니다. 이러한 잠재적 이점을 기본적으로 멀티 테 확장성 동적 환경에서 문제를 해결 하는 기술 수 있어야 합니다. HNV 이러한 문제를 해결 하 고도 실제 네트워크 토폴로지의 가상 네트워크 토폴로지 분리 하 여 데이터 센터의 작업 효율성을 개선 하도록 설계 되었습니다. 기존 표준을 개발 HNV 오늘 데이터 센터에 실행 되 고 기존 VXLAN 인프라도 작동 합니다. HNV 사용 하는 고객 개인 클라우드 데이터 센터 통합할 이제 하거나 원활 하 게 하이브리드 클라우드와 호스팅 서버 공급자의 환경에 데이터 센터 확장할 수 있습니다.  
  
## <a name="BKMK_LINKS"></a>참조 하십시오  
다음 링크를 참조 HNVv2에 대 한 자세한 내용을 보려면:  
  
|콘텐츠 종류|참조|  
|----------------|--------------|  
|**커뮤니티 리소스**|-   [개인 클라우드 아키텍처 블로그](http://blogs.technet.com/b/privatecloud)<br />-질문:[cloudnetfb@microsoft.com](mailto:%20cloudnetfb@microsoft.com)|  
|**RFC**|-   [NVGRE 초안 RFC](http://www.ietf.org/id/draft-sridharan-virtualization-nvgre-07.txt)<br />-   [VXLAN-RFC 7348](http://www.rfc-editor.org/info/rfc7348)|  
|**관련된 기술이**|-Windows Server 2012 r 2에서 기술 세부 정보 Hyper-v 네트워크 가상화 참조 [Hyper-v 네트워크 가상화 기술 세부 정보](https://technet.microsoft.com/library/jj134174.aspx)<br />-   [네트워크 컨트롤러](../../../sdn/technologies/network-controller/Network-Controller.md)|  
  


